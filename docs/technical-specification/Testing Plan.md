# План тестирования: SmartOrder Engine

## 1. Общая информация

**Версия документа**: v1.0  
**Дата**: 13.02.2026

---

## 2. Цели тестирования

- Обеспечить соответствие системы функциональным требованиям
- Обеспечить соответствие системы нефункциональным требованиям (производительность, надёжность)
- Выявить и устранить критические баги до релиза
- Обеспечить стабильность работы системы в production

---

## 3. Типы тестирования

### 3.1. Unit тесты
**Цель**: Проверка корректности работы отдельных модулей и функций

**Область покрытия**:
- Все модули в `execution/`
- Функции парсинга данных
- Функции валидации
- Функции бизнес-логики
- Утилиты и вспомогательные функции

**Критерии покрытия**: ≥ 70% кода

**Инструменты**: pytest, unittest

---

### 3.2. Integration тесты
**Цель**: Проверка взаимодействия между компонентами системы

**Область покрытия**:
- API endpoints (все endpoints должны быть протестированы)
- Интеграция с 1С HTTP Service
- Интеграция с AI API (OpenAI GPT-4)
- Интеграция с Telegram Bot API
- Интеграция с Яндекс.Почта IMAP
- Интеграция с Яндекс.Формы Webhook
- Работа с базой данных (PostgreSQL)
- Работа с очередями (Redis)

**Инструменты**: pytest, httpx для mock HTTP запросов

---

### 3.3. E2E тесты (End-to-End)
**Цель**: Проверка полного цикла обработки заказа

**Сценарии**:
1. **Полный цикл через Telegram**:
   - Клиент отправляет заказ в Telegram
   - Система парсит заказ
   - Система создаёт заказ в CRM
   - Система генерирует счёт
   - Клиент оплачивает заказ
   - Система генерирует трек-номер
   - Система экспортирует счёт в 1С (после оплаты)

2. **Полный цикл через Email**:
   - Клиент отправляет заказ на email
   - Система парсит письмо
   - Система создаёт заказ в CRM
   - Система отправляет ответное письмо с уточнениями
   - Клиент отвечает на уточнения
   - Система обрабатывает ответ
   - Система генерирует счёт и отправляет на email

3. **Полный цикл через Яндекс.Формы**:
   - Клиент заполняет форму
   - Система получает webhook
   - Система создаёт заказ в CRM
   - Система обрабатывает заказ

**Инструменты**: pytest, playwright или selenium для UI тестов

---

### 3.4. Нагрузочное тестирование
**Цель**: Проверка производительности системы под нагрузкой

**Сценарии**:
- Обработка 100 заказов в минуту (требование NFR-2)
- Синхронизация каталога с 10,000 товаров (требование NFR-4)
- Одновременная работа 50 пользователей Dashboard
- Обработка очереди из 1000 сообщений

**Метрики**:
- Время ответа API: P95 ≤ 500ms, P99 ≤ 1s (требование NFR-1)
- Время обработки заказа: ≤ 2 минуты (требование NFR-3)
- Использование ресурсов (CPU, память, диск)

**Инструменты**: locust, k6, или Apache JMeter

---

### 3.5. Тестирование безопасности
**Цель**: Проверка безопасности системы

**Область покрытия**:
- Аутентификация и авторизация API endpoints
- Защита от SQL injection
- Защита от XSS (для Dashboard)
- Валидация входных данных
- Безопасное хранение токенов и паролей
- Rate limiting для публичных API

**Инструменты**: OWASP ZAP, manual security testing

---

### 3.6. Тестирование отказоустойчивости
**Цель**: Проверка поведения системы при сбоях

**Сценарии**:
- Недоступность 1С API
- Недоступность AI API
- Недоступность базы данных
- Переполнение очереди
- Сетевые сбои

**Ожидаемое поведение**:
- Система должна использовать fallback механизмы
- Система должна логировать ошибки
- Система должна восстанавливаться после сбоя
- Данные не должны теряться

---

## 4. План тестирования по этапам

### 4.1. Этап 1: Синхронизация каталога 1С
- ✅ Unit тесты для функций синхронизации
- ✅ Integration тесты для работы с 1С API
- ✅ Тесты обработки ошибок (недоступность 1С)
- ✅ Тесты производительности (синхронизация 10,000 товаров)

### 4.2. Этап 2: Омниканальный приём заказов
- ✅ Unit тесты для парсеров (Telegram, Email, Формы)
- ✅ Integration тесты для всех каналов
- ✅ Тесты очереди (Redis)
- ✅ E2E тесты для каждого канала

### 4.3. Этап 3: AI-парсинг
- ✅ Unit тесты для функций парсинга
- ✅ Integration тесты для работы с AI API
- ✅ Тесты точности парсинга (≥ 90%)
- ✅ Тесты fallback механизмов
- ✅ Тесты валидации данных

### 4.4. Этап 4: CRM Postgres
- ✅ Unit тесты для CRUD операций
- ✅ Integration тесты для API endpoints
- ✅ Тесты фильтрации, поиска, пагинации
- ✅ Тесты производительности API

### 4.5. Этап 5: Доставка + Оплата
- ✅ Unit тесты для расчёта доставки
- ✅ Unit тесты для генерации PDF
- ✅ Integration тесты для fake оплаты
- ✅ E2E тесты полного цикла

### 4.6. Этап 6: Экспорт в 1С
- ✅ Integration тесты для экспорта счетов (после оплаты)
- ✅ Тесты retry логики
- ✅ Тесты обработки ошибок

### 4.7. Этап 7: Dashboard
- ✅ Unit тесты для компонентов Dashboard
- ✅ Integration тесты для API Dashboard
- ✅ E2E тесты для пользовательских сценариев
- ✅ Тесты производительности (обновление статистики ≤ 5 секунд)

---

## 5. Критерии покрытия

### 5.1. Покрытие кода
- **Unit тесты**: ≥ 70% кода
- **Integration тесты**: 100% API endpoints
- **E2E тесты**: Все основные пользовательские сценарии

### 5.2. Критерии готовности к релизу
- ✅ Все unit тесты проходят
- ✅ Все integration тесты проходят
- ✅ Все E2E тесты проходят
- ✅ Нагрузочное тестирование показывает соответствие требованиям
- ✅ Нет критических багов
- ✅ Покрытие кода ≥ 70%

---

## 6. Процесс тестирования

### 6.1. Разработка
- Разработчик пишет unit тесты параллельно с кодом
- Code review включает проверку тестов

### 6.2. CI/CD
- Все тесты запускаются автоматически при каждом коммите
- При падении тестов сборка блокируется

### 6.3. Перед релизом
- Полный прогон всех тестов
- Нагрузочное тестирование
- Ручное тестирование критических сценариев

---

## 7. Инструменты и окружения

### 7.1. Инструменты тестирования
- **Unit/Integration тесты**: pytest
- **E2E тесты**: pytest + playwright/selenium
- **Нагрузочное тестирование**: locust или k6
- **Mock**: unittest.mock, pytest-mock
- **Coverage**: pytest-cov

### 7.2. Тестовые окружения
- **Development**: для разработки и unit тестов
- **Staging**: для integration и E2E тестов
- **Production-like**: для нагрузочного тестирования

---

## 8. Отчётность

### 8.1. Метрики
- Процент покрытия кода
- Количество пройденных/проваленных тестов
- Время выполнения тестов
- Количество найденных багов

### 8.2. Отчёты
- Еженедельный отчёт о покрытии тестами
- Отчёт о результатах нагрузочного тестирования
- Отчёт о найденных багах и их статусе

---

**Конец документа**
