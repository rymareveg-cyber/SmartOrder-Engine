# Step-by-Step Guide: SmartOrder Engine

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

AI-—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ e-commerce —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π 1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∏—Ä–º–æ–π. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–∫–∞–∑—ã –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (Telegram, –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç–∞, –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—ã), –ø–æ–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑—ã –≤ CRM –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ç –∑–∞—è–≤–∫–∏ –¥–æ –æ–ø–ª–∞—Ç—ã.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 3-—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å–æ–≥–ª–∞—Å–Ω–æ AGENTS.md)

1. **–£—Ä–æ–≤–µ–Ω—å 1: –î–∏—Ä–µ–∫—Ç–∏–≤–∞** (`directives/`) - SOP –≤ Markdown
2. **–£—Ä–æ–≤–µ–Ω—å 2: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è** - LLM-–∞–≥–µ–Ω—Ç (–ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π)
3. **–£—Ä–æ–≤–µ–Ω—å 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** (`execution/`) - –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Python-—Å–∫—Ä–∏–ø—Ç—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ö–∞–Ω–∞–ª—ã –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–∫–∞–∑–æ–≤                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Telegram ‚îÇ  ‚îÇ –Ø–Ω–¥–µ–∫—Å.  ‚îÇ  ‚îÇ –Ø–Ω–¥–µ–∫—Å.  ‚îÇ  ‚îÇ  Webhook ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ   Bot    ‚îÇ  ‚îÇ  –ü–æ—á—Ç–∞   ‚îÇ  ‚îÇ  –§–æ—Ä–º—ã   ‚îÇ  ‚îÇ          ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ             ‚îÇ             ‚îÇ             ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Redis    ‚îÇ
                    ‚îÇ   Queue    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AI Parser    ‚îÇ  ‚îÇ  1C Catalog   ‚îÇ  ‚îÇ   CRM DB     ‚îÇ
‚îÇ  (GPT-4)     ‚îÇ  ‚îÇ   Sync        ‚îÇ  ‚îÇ  (Postgres)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                 ‚îÇ                 ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                 ‚îÇ                 ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Delivery    ‚îÇ  ‚îÇ   Payment    ‚îÇ  ‚îÇ   Invoice    ‚îÇ
‚îÇ  Calculator  ‚îÇ  ‚îÇ   Processor  ‚îÇ  ‚îÇ   Generator  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                 ‚îÇ                 ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   1C API   ‚îÇ
                    ‚îÇ  (Export)  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã AI —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ó–∞–∫–∞–∑ —á–µ—Ä–µ–∑ Telegram

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–•–æ—á—É 2 –≤–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –ø–æ 120 —Ç—ã—Å—è—á"
   ‚Üì
2. Telegram Bot ‚Üí Redis Queue (raw_message)
   {
     "channel": "telegram",
     "user_id": "123456789",
     "chat_id": "123456789",
     "message": "–•–æ—á—É 2 –≤–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –ø–æ 120 —Ç—ã—Å—è—á",
     "timestamp": "2026-02-13T10:30:00Z"
   }
   ‚Üì
3. AI Parser (GPT-4) –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
   ‚Üì
4. AI Parser –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –∏–∑ Postgres
   ‚Üì
5. AI Parser –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å:
   - –ò—â–µ—Ç "–≤–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å" –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (fuzzy search)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 2
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ü–µ–Ω—É: 120000 (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –≤ 1–°
   ‚Üì
6. AI Parser —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑:
   {
     "products": [
       {
         "articul": "–§–†-00000044",
         "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å",
         "quantity": 2,
         "price_at_order": 122334,
         "available": true,
         "stock": 1
       }
     ],
     "customer": {
       "name": null,  // —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ
       "phone": null,  // —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ
       "address": null  // —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ
     },
     "status": "needs_clarification"
   }
   ‚Üì
7. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –≤ Telegram:
   "‚úÖ –ù–∞—à—ë–ª –í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å –≤ –Ω–∞–ª–∏—á–∏–∏ (1 —à—Ç). –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ –∑–∞–∫–∞–∑ 2 —à—Ç –ø–æ 122,334‚ÇΩ?
   
   –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –Ω—É–∂–Ω—ã:
   - –í–∞—à–µ –§–ò–û
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏"
   ‚Üì
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤, +79991234567, –ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 1"
   ‚Üì
9. AI Parser –∏–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:
   {
     "customer": {
       "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
       "phone": "+79991234567",
       "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 1"
     }
   }
   ‚Üì
10. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –≤ CRM (Postgres):
    {
      "order_id": "ORD-2026-001",
      "status": "validated",
      "products": [...],
      "customer": {...},
      "total": 245168,
      "delivery_cost": 500,
      "created_at": "2026-02-13T10:35:00Z"
    }
    ‚Üì
11. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF —Å—á—ë—Ç (–¥–æ –æ–ø–ª–∞—Ç—ã)
    ‚Üì
12. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á—ë—Ç –≤ Telegram
    ‚Üì
13. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—á—ë—Ç –≤ 1–° (POST /hs/invoices) - —Å—Ç–∞—Ç—É—Å "invoice_created"
    ‚Üì
14. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç (fake –∫–∞—Ä—Ç–∞)
    ‚Üì
15. –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä
    ‚Üì
16. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑ –≤ 1–° (POST /hs/orders) - —Å—Ç–∞—Ç—É—Å "paid"
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–∫–∞–∑ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç—É

```
1. IMAP –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ‚Üí –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–∏—Å—å–º–æ —Å —Ç–µ–º–æ–π "–ó–∞–∫–∞–∑"
   ‚Üì
2. –ü–∞—Ä—Å–∏–Ω–≥ –ø–∏—Å—å–º–∞:
   "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å:
   - 3x –®—É–±–∞ –Ω–æ—Ä–∫–æ–≤–∞—è
   - –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥
   –ö–æ–Ω—Ç–∞–∫—Ç—ã: –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤, +79997654321"
   ‚Üì
3. –ü–∏—Å—å–º–æ ‚Üí Redis Queue
   {
     "channel": "yandex_mail",
     "email": "customer@example.com",
     "subject": "–ó–∞–∫–∞–∑",
     "body": "...",
     "timestamp": "2026-02-13T11:00:00Z"
   }
   ‚Üì
4. AI Parser –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Telegram)
   ‚Üì
5. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
   –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–Ω–æ–≥–æ –ø–∏—Å—å–º–∞ —Å —É—Ç–æ—á–Ω–µ–Ω–∏—è–º–∏
```

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º

---

## –≠–¢–ê–ü 1: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ 1–°

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∏—Ä–º–æ–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Postgres —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/sync_1c_catalog.py** - —Å–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **execution/api_catalog_server.py** - FastAPI endpoint –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É
- **directives/1c_catalog_sync.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **database/migrations/001_create_catalog_tables.sql** - —Å—Ö–µ–º–∞ –ë–î

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI

```
–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ 1–° –≤ Postgres —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. –°–∫—Ä–∏–ø—Ç execution/sync_1c_catalog.py:
   - GET –∑–∞–ø—Ä–æ—Å –∫ /hs/api/get/catalog/ (1C HTTP Service)
   - –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞: –∞—Ä—Ç–∏–∫—É–ª, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, –æ—Å—Ç–∞—Ç–æ–∫
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Postgres —Ç–∞–±–ª–∏—Ü—É products —Å –ø–æ–ª—è–º–∏:
     * id (UUID, primary key)
     * articul (VARCHAR, unique, indexed)
     * name (VARCHAR, indexed –¥–ª—è –ø–æ–∏—Å–∫–∞)
     * price (DECIMAL)
     * stock (INTEGER)
     * updated_at (TIMESTAMP)
     * synced_at (TIMESTAMP)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (retry logic, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
   - Upsert –ª–æ–≥–∏–∫–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö)

2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (APScheduler –∏–ª–∏ cron):
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π

3. FastAPI endpoint /catalog:
   - GET /catalog - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏
   - GET /catalog/search?q=–≤–∞—Ä–æ—á–Ω–∞—è - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∞—Ä—Ç–∏–∫—É–ª—É
   - GET /catalog/{articul} - —Ç–æ–≤–∞—Ä –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ (Redis, TTL 5 –º–∏–Ω—É—Ç)

4. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ directives/1c_catalog_sync.md:
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö 1–° API
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤ (–Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤, –æ—à–∏–±–∫–∞ API, —Ç–∞–π–º–∞—É—Ç)

5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
   - ONEC_BASE_URL=http://1c-server:port
   - ONEC_USERNAME=...
   - ONEC_PASSWORD=...
   - DATABASE_URL=postgresql://...
   - REDIS_URL=redis://...

–ò—Å–ø–æ–ª—å–∑—É–π –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏: connection pooling, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–Ω–¥–µ–∫—Å—ã –ë–î, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –°–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ë–î
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- ‚úÖ API endpoint /catalog –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (–∏–Ω–¥–µ–∫—Å—ã)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –≠–¢–ê–ü 2: –û–º–Ω–∏–∫–∞–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏—ë–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ (Telegram, –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç–∞, –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—ã) —Å –µ–¥–∏–Ω–æ–π –æ—á–µ—Ä–µ–¥—å—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ Redis.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/telegram_bot.py** - Telegram –±–æ—Ç
- **execution/yandex_mail_parser.py** - IMAP –ø–∞—Ä—Å–µ—Ä –ø–æ—á—Ç—ã
- **execution/yandex_forms_webhook.py** - webhook –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º
- **execution/queue_processor.py** - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ—Ä–µ–¥–∏ Redis
- **directives/omnichannel_orders.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Telegram Bot)

```
–°–æ–∑–¥–∞–π Telegram –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏—ë–º–∞ –∑–∞–∫–∞–∑–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/telegram_bot.py:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ python-telegram-bot –∏–ª–∏ aiogram
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∑–∞–∫–∞–∑–∞–º–∏
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Redis Queue:
     {
       "channel": "telegram",
       "user_id": str,
       "chat_id": str,
       "message": str,
       "timestamp": ISO8601,
       "message_id": int
     }
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥: /start, /help, /status
   - Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ callback_query –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

2. Telegram Mini App (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –±—É–¥—É—â–µ–≥–æ):
   - –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ webapp
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ web_app_data

3. Redis Queue —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
   - –ö–ª—é—á: "orders:queue"
   - –¢–∏–ø: List (LPUSH/RPOP)
   - –§–æ—Ä–º–∞—Ç: JSON —Å—Ç—Ä–æ–∫–∏

4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Redis
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - TELEGRAM_BOT_TOKEN=...
   - REDIS_URL=redis://...
   - TELEGRAM_ADMIN_ID=...

–°–ª–µ–¥—É–π best practices: async/await, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (–Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç–∞ IMAP)

```
–°–æ–∑–¥–∞–π IMAP –ø–∞—Ä—Å–µ—Ä –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç—ã —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/yandex_mail_parser.py:
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ IMAP —Å–µ—Ä–≤–µ—Ä—É –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç—ã
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∏—Å–µ–º (polling –∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∏—Å–µ–º –ø–æ —Ç–µ–º–µ/–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ)
   - –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –ø–∏—Å—å–º–∞ (plain text + HTML fallback)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã —Å –∑–∞–∫–∞–∑–∞–º–∏)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Redis Queue:
     {
       "channel": "yandex_mail",
       "email": str,
       "subject": str,
       "body": str,
       "attachments": [{"filename": str, "content": base64}],
       "timestamp": ISO8601
     }
   - –ü–æ–º–µ—á–µ–Ω–∏–µ –ø–∏—Å–µ–º –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ IMAP (reconnect, retry)

2. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ directives/yandex_mail_parsing.md:
   - –§–æ—Ä–º–∞—Ç –ø–∏—Å–µ–º —Å –∑–∞–∫–∞–∑–∞–º–∏
   - –ü—Ä–∏–º–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞–µ–≤ (–ø—É—Å—Ç—ã–µ –ø–∏—Å—å–º–∞, —Å–ø–∞–º, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - YANDEX_MAIL_IMAP_HOST=imap.yandex.ru
   - YANDEX_MAIL_EMAIL=...
   - YANDEX_MAIL_PASSWORD=...
   - YANDEX_MAIL_FOLDER=INBOX
   - REDIS_URL=redis://...

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É imaplib –∏–ª–∏ aioimaplib –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π.
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (–Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—ã Webhook)

```
–°–æ–∑–¥–∞–π webhook endpoint –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/yandex_forms_webhook.py:
   - FastAPI endpoint POST /webhook/yandex-forms
   - –ü—Ä–∏—ë–º JSON payload –æ—Ç –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (pydantic models)
   - –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç:
     {
       "channel": "yandex_forms",
       "form_id": str,
       "form_name": str,
       "submission_id": str,
       "data": dict,  // –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
       "timestamp": ISO8601
     }
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Redis Queue
   - –û—Ç–≤–µ—Ç 200 OK –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º

2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞ (–µ—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
   - Rate limiting
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - YANDEX_FORMS_SECRET=...
   - REDIS_URL=redis://...

–°–ª–µ–¥—É–π best practices FastAPI: dependency injection, middleware, error handling.
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Queue Processor)

```
–°–æ–∑–¥–∞–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ Redis —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/queue_processor.py:
   - –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ (worker)
   - BRPOP –∏–∑ Redis Queue (–±–ª–æ–∫–∏—Ä—É—é—â–∏–π pop)
   - –ü–∞—Ä—Å–∏–Ω–≥ JSON —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –∫–∞–Ω–∞–ª–∞–º (telegram, yandex_mail, yandex_forms)
   - –í—ã–∑–æ–≤ AI Parser –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (dead letter queue)
   - –ú–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, –æ—à–∏–±–∫–∏

2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
   - Async –æ–±—Ä–∞–±–æ—Ç–∫–∞ (asyncio)
   - Connection pooling –¥–ª—è Redis
   - Graceful shutdown (–æ–±—Ä–∞–±–æ—Ç–∫–∞ SIGTERM)
   - Health check endpoint

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - REDIS_URL=redis://...
   - AI_PARSER_URL=http://localhost:8001 (–∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤)
   - WORKER_CONCURRENCY=5

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É redis-py –∏–ª–∏ aioredis –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π.
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ Telegram –±–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å
- ‚úÖ IMAP –ø–∞—Ä—Å–µ—Ä –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø–æ—á—Ç—É –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∏—Å—å–º–∞
- ‚úÖ Webhook –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º
- ‚úÖ –í—Å–µ –∫–∞–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –µ–¥–∏–Ω—É—é Redis Queue
- ‚úÖ Queue Processor –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏

---

## –≠–¢–ê–ü 3: AI-–ø–∞—Ä—Å–∏–Ω–≥ GPT

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å AI-–º–æ–¥—É–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ GPT-4 –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤, –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ 1–°, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/ai_order_parser.py** - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å AI-–ø–∞—Ä—Å–∏–Ω–≥–∞
- **execution/prompt_templates.py** - —à–∞–±–ª–æ–Ω—ã –ø—Ä–æ–º–ø—Ç–æ–≤
- **directives/ai_parsing.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ AI-–ø–∞—Ä—Å–∏–Ω–≥—É
- **execution/catalog_matcher.py** - –º–æ–¥—É–ª—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI

```
–°–æ–∑–¥–∞–π AI-–º–æ–¥—É–ª—å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/ai_order_parser.py:
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI API (GPT-4)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Postgres
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è GPT-4:
     * –ö–æ–Ω—Ç–µ–∫—Å—Ç: –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ (JSON)
     * –ó–∞–¥–∞—á–∞: –∏–∑–≤–ª–µ—á—å —Ç–æ–≤–∞—Ä—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
     * –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON
   - –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ GPT-4
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
     * –¢–æ–≤–∞—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–∞—Ç–∞–ª–æ–≥–µ?
     * –û—Å—Ç–∞—Ç–æ–∫ >= –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞?
     * –ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ –≤–∞–ª–∏–¥–Ω—ã?
   - –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)

2. execution/prompt_templates.py:
   - –®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤:
     """
     –¢—ã - AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ.
     
     –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤:
     {catalog_json}
     
     –°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:
     {customer_message}
     
     –ó–∞–¥–∞—á–∞:
     1. –ù–∞–π–¥–∏ —É–ø–æ–º—è–Ω—É—Ç—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É)
     2. –ò–∑–≤–ª–µ–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
     3. –ò–∑–≤–ª–µ–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å
     4. –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ - —É–∫–∞–∂–∏ —ç—Ç–æ
     
     –û—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
     {{
       "products": [
         {{
           "articul": "string",
           "name": "string",
           "quantity": int,
           "price_mentioned": float (optional)
         }}
       ],
       "customer": {{
         "name": "string or null",
         "phone": "string or null",
         "address": "string or null"
       }},
       "missing_data": ["name", "phone", ...],
       "unfound_products": ["–Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"]
     }}
     """
   - –®–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
   - –®–∞–±–ª–æ–Ω –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

3. execution/catalog_matcher.py:
   - Fuzzy matching —Ç–æ–≤–∞—Ä–æ–≤ (fuzzywuzzy, rapidfuzz)
   - –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
   - –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, —Å–∏–Ω–æ–Ω–∏–º—ã)
   - –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)

4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - Retry –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö OpenAI API
   - Fallback –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ (regex) –µ—Å–ª–∏ GPT –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ GPT

5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - OPENAI_API_KEY=...
   - OPENAI_MODEL=gpt-4
   - DATABASE_URL=postgresql://...
   - REDIS_URL=redis://...

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: openai, pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, asyncio –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π.
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã AI-–ø–∞—Ä—Å–µ—Ä–∞

**–í—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
"–•–æ—á—É 2 –≤–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –ø–æ 120 —Ç—ã—Å—è—á, –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –ú–æ—Å–∫–≤—É"
```

**–ö–∞—Ç–∞–ª–æ–≥ (–∏–∑ –ë–î):**
```json
[
  {"articul": "–§–†-00000044", "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å", "price": 122334, "stock": 1},
  {"articul": "–§–†-00000389", "name": "–®—É–±–∞ –Ω–æ—Ä–∫–æ–≤–∞—è", "price": 50000, "stock": 4}
]
```

**–ü—Ä–æ–º–ø—Ç –¥–ª—è GPT-4:**
```
–¢—ã - AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤...

–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤:
[{"articul": "–§–†-00000044", "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å", ...}, ...]

–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:
"–•–æ—á—É 2 –≤–∞—Ä–æ—á–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –ø–æ 120 —Ç—ã—Å—è—á, –¥–æ—Å—Ç–∞–≤–∫–∞ –≤ –ú–æ—Å–∫–≤—É"

–ó–∞–¥–∞—á–∞: –∏–∑–≤–ª–µ–∫–∏ —Ç–æ–≤–∞—Ä—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –∫–æ–Ω—Ç–∞–∫—Ç—ã...
```

**–û—Ç–≤–µ—Ç GPT-4:**
```json
{
  "products": [
    {
      "articul": "–§–†-00000044",
      "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å",
      "quantity": 2,
      "price_mentioned": 120000
    }
  ],
  "customer": {
    "name": null,
    "phone": null,
    "address": "–ú–æ—Å–∫–≤–∞"
  },
  "missing_data": ["name", "phone", "full_address"],
  "unfound_products": []
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
```json
{
  "order_id": "temp-123",
  "status": "needs_clarification",
  "products": [
    {
      "articul": "–§–†-00000044",
      "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å",
      "quantity": 2,
      "price_at_order": 122334,
      "available": true,
      "stock": 1,
      "validated": true
    }
  ],
  "customer": {
    "name": null,
    "phone": null,
    "address": "–ú–æ—Å–∫–≤–∞"
  },
  "clarification_questions": [
    "–£–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∞—à–µ –§–ò–û",
    "–£–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω",
    "–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –ú–æ—Å–∫–≤–µ"
  ]
}
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ AI-–ø–∞—Ä—Å–µ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç (fuzzy matching)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã

---

## –≠–¢–ê–ü 4: CRM Postgres

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ Postgres —Å –ø–æ–ª–Ω—ã–º CRUD –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–∞–∫–∞–∑–∞.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **database/migrations/002_create_orders_tables.sql** - —Å—Ö–µ–º–∞ –ë–î –∑–∞–∫–∞–∑–æ–≤
- **execution/crm_service.py** - —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
- **execution/api_orders.py** - FastAPI endpoints –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
- **directives/crm_orders.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ CRM

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI

```
–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏ –≤ Postgres —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. database/migrations/002_create_orders_tables.sql:
   - –¢–∞–±–ª–∏—Ü–∞ orders:
     * id (UUID, primary key)
     * order_number (VARCHAR, unique, auto-generated: ORD-YYYY-NNNN)
     * status (ENUM: new, validated, invoice_created, paid, shipped, cancelled)
     * channel (VARCHAR: telegram, yandex_mail, yandex_forms)
     * customer_name (VARCHAR)
     * customer_phone (VARCHAR)
     * customer_address (TEXT)
     * total_amount (DECIMAL)
     * delivery_cost (DECIMAL)
     * created_at (TIMESTAMP)
     * updated_at (TIMESTAMP)
     * paid_at (TIMESTAMP, nullable)
     * shipped_at (TIMESTAMP, nullable)
   
   - –¢–∞–±–ª–∏—Ü–∞ order_items:
     * id (UUID, primary key)
     * order_id (UUID, foreign key -> orders.id)
     * product_articul (VARCHAR, foreign key -> products.articul)
     * product_name (VARCHAR)  // snapshot –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
     * quantity (INTEGER)
     * price_at_order (DECIMAL)  // —Ü–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞
     * total (DECIMAL)  // quantity * price_at_order
   
   - –ò–Ω–¥–µ–∫—Å—ã: order_number, status, created_at, customer_phone
   - Constraints: quantity > 0, price_at_order > 0

2. execution/crm_service.py:
   - –ö–ª–∞—Å—Å OrderService:
     * create_order(data) -> Order
     * get_order(order_id) -> Order
     * update_order_status(order_id, status) -> Order
     * list_orders(filters) -> List[Order]
     * add_order_item(order_id, item_data) -> OrderItem
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (pydantic models)
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è order_number

3. execution/api_orders.py:
   - FastAPI endpoints:
     * POST /api/orders - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
     * GET /api/orders/{order_id} - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
     * PATCH /api/orders/{order_id}/status - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
     * GET /api/orders - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ (—Ñ–∏–ª—å—Ç—Ä—ã, –ø–∞–≥–∏–Ω–∞—Ü–∏—è)
     * GET /api/orders/{order_id}/items - —Ç–æ–≤–∞—Ä—ã –∑–∞–∫–∞–∑–∞
   - Pydantic models –¥–ª—è request/response
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (404, 400, 500)

4. –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞:
   - new: –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω)
   - validated: –ø—Ä–æ–≤–µ—Ä–µ–Ω AI-–ø–∞—Ä—Å–µ—Ä–æ–º, –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
   - invoice_created: —Å—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
   - paid: –æ–ø–ª–∞—á–µ–Ω
   - shipped: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω (—Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä —Å–æ–∑–¥–∞–Ω)
   - cancelled: –æ—Ç–º–µ–Ω—ë–Ω

5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - DATABASE_URL=postgresql://...

–ò—Å–ø–æ–ª—å–∑—É–π SQLAlchemy ORM –∏–ª–∏ asyncpg –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î. –°–ª–µ–¥—É–π best practices: migrations, transactions, indexes.
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ö–µ–º–∞ –ë–î —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## –≠–¢–ê–ü 5: –î–æ—Å—Ç–∞–≤–∫–∞ + –û–ø–ª–∞—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–æ)

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF —Å—á—ë—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã (fake –∫–∞—Ä—Ç–∞) —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/delivery_calculator.py** - —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- **execution/invoice_generator.py** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å—á—ë—Ç–æ–≤
- **execution/payment_processor.py** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø–ª–∞—Ç—ã
- **execution/tracking_generator.py** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤
- **directives/delivery_payment.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Delivery Calculator)

```
–°–æ–∑–¥–∞–π –º–æ–¥—É–ª—å —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/delivery_calculator.py:
   - –ö–ª–∞—Å—Å DeliveryCalculator:
     * calculate(city: str, weight: float, dimensions: dict) -> dict
   - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–æ, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API):
     * –ú–æ—Å–∫–≤–∞: 500‚ÇΩ (–¥–æ 5–∫–≥), 800‚ÇΩ (5-10–∫–≥), 1200‚ÇΩ (>10–∫–≥)
     * –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥: 600‚ÇΩ (–¥–æ 5–∫–≥), 900‚ÇΩ (5-10–∫–≥), 1400‚ÇΩ (>10–∫–≥)
     * –î—Ä—É–≥–∏–µ –≥–æ—Ä–æ–¥–∞: 1000‚ÇΩ (–¥–æ 5–∫–≥), 1500‚ÇΩ (5-10–∫–≥), 2000‚ÇΩ (>10–∫–≥)
   - –†–∞—Å—á—ë—Ç –≤–µ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ
   - –í–æ–∑–≤—Ä–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
     {
       "city": str,
       "weight": float,
       "cost": float,
       "estimated_days": int,
       "carrier": "local"
     }

2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∑–∞–∫–∞–∑–∞–º–∏:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ delivery_cost –≤ orders.delivery_cost

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - DELIVERY_RULES_JSON=... (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—É—é –ª–æ–≥–∏–∫—É –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Invoice Generator)

```
–°–æ–∑–¥–∞–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä PDF —Å—á—ë—Ç–æ–≤ –≤ —Å—Ç–∏–ª–µ 1–° —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/invoice_generator.py:
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å—á—ë—Ç–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ reportlab –∏–ª–∏ weasyprint
   - –§–æ—Ä–º–∞—Ç —Å—á—ë—Ç–∞ (1–°-—Å—Ç–∏–ª—å):
     * –®–∞–ø–∫–∞: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏, –ò–ù–ù, –ö–ü–ü, –∞–¥—Ä–µ—Å
     * –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞: INV-YYYY-NNNN
     * –î–∞—Ç–∞ —Å—á—ë—Ç–∞
     * –ü–ª–∞—Ç–µ–ª—å—â–∏–∫: –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å
     * –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤:
       - ‚Ññ | –ê—Ä—Ç–∏–∫—É–ª | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ | –ö–æ–ª-–≤–æ | –¶–µ–Ω–∞ | –°—É–º–º–∞
     * –ò—Ç–æ–≥–æ: —Å—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤ + –¥–æ—Å—Ç–∞–≤–∫–∞ = –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
     * –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã (fake)
   
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ PDF –≤ .tmp/invoices/{order_id}.pdf
   - –í–æ–∑–≤—Ä–∞—Ç –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É

2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "validated"
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ "invoice_created"
   - –û—Ç–ø—Ä–∞–≤–∫–∞ PDF –∫–ª–∏–µ–Ω—Ç—É (Telegram/Email)

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - COMPANY_NAME=...
   - COMPANY_INN=...
   - COMPANY_KPP=...
   - COMPANY_ADDRESS=...

–°–ª–µ–¥—É–π best practices: —à–∞–±–ª–æ–Ω–∏–∑–∞—Ü–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π.
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Payment Processor)

```
–°–æ–∑–¥–∞–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø–ª–∞—Ç—ã (fake –∫–∞—Ä—Ç–∞) —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/payment_processor.py:
   - –ö–ª–∞—Å—Å PaymentProcessor:
     * process_payment(order_id, card_data) -> dict
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã (—Ñ–æ—Ä–º–∞—Ç, –Ω–µ —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞):
     * –ù–æ–º–µ—Ä: 16 —Ü–∏—Ñ—Ä
     * CVV: 3 —Ü–∏—Ñ—Ä—ã
     * –°—Ä–æ–∫: MM/YY
     * –ò–º—è –¥–µ—Ä–∂–∞—Ç–µ–ª—è
   - –°–∏–º—É–ª—è—Ü–∏—è –æ–ø–ª–∞—Ç—ã:
     * –í—Å–µ–≥–¥–∞ —É—Å–ø–µ—à–Ω–∞—è (fake)
     * –ó–∞–¥–µ—Ä–∂–∫–∞ 1-2 —Å–µ–∫—É–Ω–¥—ã (–∏–º–∏—Ç–∞—Ü–∏—è)
     * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è transaction_id
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:
     * –°—Ç–∞—Ç—É—Å ‚Üí "paid"
     * paid_at ‚Üí —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
     * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ transaction_id

2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã (–±–µ–∑ CVV –≤ –ª–æ–≥–∞—Ö!)
   - –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - (–Ω–µ—Ç, –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ)

‚ö†Ô∏è –í–ê–ñ–ù–û: –≠—Ç–æ fake —Å–∏—Å—Ç–µ–º–∞, –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!
```

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI (Tracking Generator)

```
–°–æ–∑–¥–∞–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/tracking_generator.py:
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
   - –§–æ—Ä–º–∞—Ç: TRACK-{YYYYMMDD}-{6 random digits}
   - –ü—Ä–∏–º–µ—Ä: TRACK-20260213-123456
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ orders.tracking_number (–Ω–æ–≤–æ–µ –ø–æ–ª–µ)
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí "shipped"
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ shipped_at ‚Üí —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è

2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É

3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - (–Ω–µ—Ç)

–ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API.
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –†–∞—Å—á—ë—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
- ‚úÖ PDF —Å—á—ë—Ç—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∏–ª–µ 1–°
- ‚úÖ –û–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (fake)
- ‚úÖ –¢—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –≠–¢–ê–ü 6: –ó–∞–ø–∏—Å—å –æ–±—Ä–∞—Ç–Ω–æ –≤ 1–°

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ —Å—á–µ—Ç–æ–≤ –æ–±—Ä–∞—Ç–Ω–æ –≤ 1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∏—Ä–º–æ–π —á–µ—Ä–µ–∑ HTTP Service.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/1c_exporter.py** - —ç–∫—Å–ø–æ—Ä—Ç –≤ 1–°
- **directives/1c_export.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ –ø–æ —ç–∫—Å–ø–æ—Ä—Ç—É

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI

```
–°–æ–∑–¥–∞–π –º–æ–¥—É–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ —Å—á–µ—Ç–æ–≤ –≤ 1–° —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/1c_exporter.py:
   - –ö–ª–∞—Å—Å OneCExporter:
     * export_invoice(order_id) -> dict
     * export_order(order_id) -> dict
   
   - POST /hs/invoices:
     * –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö (JSON):
       {
         "invoice_number": "INV-2026-001",
         "date": "2026-02-13",
         "customer": {
           "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
           "phone": "+79991234567",
           "address": "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 1"
         },
         "items": [
           {
             "articul": "–§–†-00000044",
             "name": "–í–∞—Ä–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å",
             "quantity": 2,
             "price": 122334,
             "total": 244668
           }
         ],
         "total": 200300,
         "delivery_cost": 500
       }
     * –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "invoice_created" (–î–û –æ–ø–ª–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–º)
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ 1–°
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (retry, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
   
   - POST /hs/orders:
     * –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
     * –≠–∫—Å–ø–æ—Ä—Ç –ø–æ—Å–ª–µ —Å—Ç–∞—Ç—É—Å–∞ "paid" (–ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–º)

2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç —Å—á—ë—Ç–∞ –≤ 1–° –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "invoice_created" (–î–û –æ–ø–ª–∞—Ç—ã)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–∞ –≤ 1–° –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "paid" (–ü–û–°–õ–ï –æ–ø–ª–∞—Ç—ã)
   - –§–ª–∞–≥–∏ invoice_exported_to_1c –∏ order_exported_to_1c –≤ orders (boolean)

3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
   - Retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö (3 –ø–æ–ø—ã—Ç–∫–∏)
   - Dead letter queue –¥–ª—è –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤

4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - ONEC_BASE_URL=http://1c-server:port
   - ONEC_USERNAME=...
   - ONEC_PASSWORD=...
   - ONEC_INVOICES_ENDPOINT=/hs/invoices
   - ONEC_ORDERS_ENDPOINT=/hs/orders

–ò—Å–ø–æ–ª—å–∑—É–π –±–∏–±–ª–∏–æ—Ç–µ–∫—É httpx –∏–ª–∏ requests –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤. –°–ª–µ–¥—É–π best practices: retry logic, timeout, error handling.
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Å—á–µ—Ç–æ–≤ –≤ 1–° —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ –≤ 1–° —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry –ª–æ–≥–∏–∫–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤
- ‚úÖ –§–ª–∞–≥–∏ exported_to_1c –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è

---

## –≠–¢–ê–ü 7: Dashboard –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **execution/dashboard_api.py** - API –¥–ª—è dashboard
- **execution/dashboard_frontend/** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (React/Vue –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π HTML)
- **directives/dashboard.md** - –¥–∏—Ä–µ–∫—Ç–∏–≤–∞

### –ü—Ä–æ–º–ø—Ç –¥–ª—è CursorAI

```
–°–æ–∑–¥–∞–π Dashboard –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏–∑ AGENTS.md.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. execution/dashboard_api.py:
   - FastAPI endpoints:
     * GET /api/dashboard/stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
       - –í—ã—Ä—É—á–∫–∞ (—Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—è, –º–µ—Å—è—Ü)
       - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
       - –ö–æ–Ω–≤–µ—Ä—Å–∏—è (–Ω–æ–≤—ã–µ ‚Üí –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ)
       - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
       - –¢–æ–ø —Ç–æ–≤–∞—Ä–æ–≤
     * GET /api/dashboard/orders - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤:
       - –§–∏–ª—å—Ç—Ä—ã: —Å—Ç–∞—Ç—É—Å, –∫–∞–Ω–∞–ª, –¥–∞—Ç–∞
       - –ü–æ–∏—Å–∫: –ø–æ –Ω–æ–º–µ—Ä—É, –§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω—É
       - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ø–æ –¥–∞—Ç–µ, —Å—É–º–º–µ
       - –ü–∞–≥–∏–Ω–∞—Ü–∏—è
     * GET /api/dashboard/orders/{order_id} - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
     * PATCH /api/dashboard/orders/{order_id}/status - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
     * GET /api/dashboard/catalog - –∫–∞—Ç–∞–ª–æ–≥ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ (live sync)
     * GET /api/dashboard/sync-status - —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ 1–°

2. execution/dashboard_frontend/:
   - –ü—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (React –∏–ª–∏ Vue):
     * –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤: —Ç–∞–±–ª–∏—Ü–∞, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫
     * –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: –≥—Ä–∞—Ñ–∏–∫–∏, –º–µ—Ç—Ä–∏–∫–∏
     * –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞: —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤, –æ—Å—Ç–∞—Ç–∫–∏
     * –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞: –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
   - –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ–π HTML + JavaScript (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø)

3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤—Ä—É—á–Ω—É—é
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ 1–°
   - –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (CSV)

4. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - DATABASE_URL=postgresql://...
   - DASHBOARD_PORT=8025

–ò—Å–ø–æ–ª—å–∑—É–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫: FastAPI –¥–ª—è backend, React/Vue –¥–ª—è frontend (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π HTML –¥–ª—è MVP).
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ Dashboard –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–∞–∫–∞–∑—ã
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ (–∏—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

### –°—Ö–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∑–∞–∫–∞–∑–∞

```
new (–Ω–æ–≤—ã–π)
  ‚Üì [AI-–ø–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω, –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã]
validated (–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω)
  ‚Üì [PDF —Å—á—ë—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É]
invoice_created (—Å—á—ë—Ç —Å–æ–∑–¥–∞–Ω)
  ‚Üì [—Å—á—ë—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ 1–°]
  ‚Üì [–∫–ª–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª]
paid (–æ–ø–ª–∞—á–µ–Ω)
  ‚Üì [–∑–∞–∫–∞–∑ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ 1–°]
  ‚Üì [—Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä —Å–æ–∑–¥–∞–Ω]
shipped (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è 1–°**: Retry, fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
2. **–ü—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤**: Dead letter queue, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. **AI-–ø–∞—Ä—Å–∏–Ω–≥**: Fallback –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ (regex), –∑–∞–ø—Ä–æ—Å —É—Ç–æ—á–Ω–µ–Ω–∏–π
4. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**: –í–∞–ª–∏–¥–∞—Ü–∏—è, –æ—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—á—ë—Ç–∞**: Retry, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
6. **–≠–∫—Å–ø–æ—Ä—Ç —Å—á—ë—Ç–∞ –≤ 1–°**: Retry (3 –ø–æ–ø—ã—Ç–∫–∏), dead letter queue (–ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "invoice_created")
7. **–û–ø–ª–∞—Ç–∞**: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
8. **–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–∞ –≤ 1–°**: Retry (3 –ø–æ–ø—ã—Ç–∫–∏), dead letter queue (–ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ "paid")

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í—Å–µ —Å–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏)
- –ú–µ—Ç—Ä–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤, –æ—à–∏–±–∫–∏, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- Health checks –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Postgres
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω Redis
- [ ] –ü–æ–ª—É—á–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã API (OpenAI, Telegram, –Ø–Ω–¥–µ–∫—Å.–ü–æ—á—Ç–∞)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–æ—Å—Ç—É–ø –∫ 1–° HTTP Service
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π (execution/, directives/, .tmp/)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω .env —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (requirements.txt)

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–≠—Ç–∞–ø 1** - –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–∫–∞—Ç–∞–ª–æ–≥)
2. **–≠—Ç–∞–ø 2** - –ü—Ä–∏—ë–º –∑–∞–∫–∞–∑–æ–≤ (—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–∞–Ω–∞–ª)
3. **–≠—Ç–∞–ø 3** - AI-–ø–∞—Ä—Å–∏–Ω–≥ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
4. **–≠—Ç–∞–ø 4** - CRM (—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤)
5. **–≠—Ç–∞–ø 5** - –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞
6. **–≠—Ç–∞–ø 6** - –≠–∫—Å–ø–æ—Ä—Ç –≤ 1–°
7. **–≠—Ç–∞–ø 7** - Dashboard (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ)

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–∞—á–Ω–∏ —Å –≠—Ç–∞–ø–∞ 1** - –±–µ–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **–¢–µ—Å—Ç–∏—Ä—É–π –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø** –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
3. **–ò—Å–ø–æ–ª—å–∑—É–π –¥–∏—Ä–µ–∫—Ç–∏–≤—ã** - –æ–Ω–∏ –ø–æ–º–æ–≥—É—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É
4. **–õ–æ–≥–∏—Ä—É–π –≤—Å—ë** - —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –æ—Ç–ª–∞–¥–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
5. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏** - —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤–æ–π
6. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞—Ö –ø–æ –º–µ—Ä–µ –æ–±—É—á–µ–Ω–∏—è

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend**: Python 3.11+, FastAPI, SQLAlchemy/asyncpg
- **Database**: PostgreSQL 14+
- **Queue**: Redis 7+
- **AI**: OpenAI GPT-4
- **PDF**: reportlab –∏–ª–∏ weasyprint
- **Frontend**: React/Vue –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ–π HTML+JS
- **Deployment**: Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

**–£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**
