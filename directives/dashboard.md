# Директива: Dashboard для менеджера

## Цель
Создать веб-интерфейс для управления заказами, просмотра статистики и мониторинга системы SmartOrder Engine.

## Компоненты

### execution/dashboard_api.py
- FastAPI сервер с REST API endpoints
- Статический сервер для frontend файлов
- CORS middleware для работы с frontend

### execution/dashboard_frontend/
- `index.html` - главная страница с современным дизайном
- `dashboard.js` - JavaScript логика для работы с API

## API Endpoints

### GET /api/dashboard/stats
Статистика для dashboard:
- Выручка (сегодня, неделя, месяц)
- Количество заказов
- Конверсия (новые → оплаченные)
- Средний чек
- Топ товаров

### GET /api/dashboard/orders
Список заказов с фильтрацией:
- Фильтры: статус, канал
- Поиск: по номеру, ФИО, телефону
- Сортировка: по дате, сумме
- Пагинация

### GET /api/dashboard/orders/{order_id}
Детальная информация о заказе:
- Все поля заказа
- Список товаров
- История статусов

### PATCH /api/dashboard/orders/{order_id}/status
Изменение статуса заказа вручную.

### GET /api/dashboard/catalog
Каталог товаров с остатками:
- Поиск по названию/артикулу
- Пагинация

### GET /api/dashboard/sync-status
Статус синхронизации с 1С:
- Последняя синхронизация
- Количество товаров
- Статус (ok/warning/error)

## Frontend

### Дизайн
- Современный интерфейс с градиентами
- Tailwind CSS для стилей
- Chart.js для графиков
- Font Awesome для иконок
- Адаптивный дизайн

### Функционал
- **Вкладка "Статистика"**:
  - Карточки с метриками (выручка, конверсия, средний чек)
  - Топ товаров
  - График заказов по периодам

- **Вкладка "Заказы"**:
  - Таблица заказов
  - Фильтры по статусу и каналу
  - Поиск
  - Пагинация
  - Просмотр деталей заказа
  - Изменение статуса

- **Вкладка "Каталог"**:
  - Таблица товаров
  - Поиск
  - Отображение остатков

### Автообновление
- Обновление данных каждые 30 секунд
- Проверка статуса синхронизации каждую минуту

## Переменные окружения

```env
DASHBOARD_PORT=8025
DASHBOARD_HOST=0.0.0.0
DATABASE_URL=postgresql://...
```

## Запуск

### Backend:
```bash
python execution/dashboard_api.py
```

### Доступ:
- Dashboard: `http://localhost:8025/`
- API: `http://localhost:8025/api/dashboard/...`

## Крайние случаи

### 1. Нет данных
- Отображается сообщение "Нет данных" или "Заказы не найдены"
- Пустые состояния с иконками

### 2. Ошибки загрузки
- Показываются уведомления об ошибках
- Логирование в консоль браузера

### 3. Медленное соединение
- Индикаторы загрузки
- Асинхронная загрузка данных

## Обновление директивы

При обнаружении проблем или улучшений:
1. Обновить эту директиву
2. Обновить код в `execution/dashboard_api.py` и `execution/dashboard_frontend/`
3. Протестировать изменения
4. Обновить документацию в `docs/Step-by-Step Guide.md` при необходимости
