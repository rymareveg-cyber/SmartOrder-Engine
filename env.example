# Переменные окружения для SmartOrder Engine
# Скопируйте этот файл в .env и заполните реальными значениями

# ===========================================
# 1С:Управление нашей фирмой
# ===========================================
# Базовый URL 1С HTTP Service
# Пример: http://1c-server:80 или http://192.168.1.100:80
# Если используется Universal 1C HTTP API Bridge, endpoint будет: /hs/api/get/catalog/
# Примечание: порт 80 - стандартный HTTP порт, может быть опущен в URL
ONEC_BASE_URL=http://localhost:80

# Учетные данные для Basic Auth
ONEC_USERNAME=admin
ONEC_PASSWORD=password

# Endpoint для экспорта счетов в 1С
# Пример: /hs/invoices или /hs/api/post/create_invoice/
ONEC_INVOICES_ENDPOINT=/hs/api/post/create_invoice/

# ===========================================
# База данных PostgreSQL
# ===========================================
# Строка подключения к PostgreSQL
# Формат: postgresql://user:password@host:port/database
# Пример: postgresql://smartorder:password@localhost:5432/smartorder
DATABASE_URL=postgresql://smartorder:password@localhost:5432/smartorder

# Настройки connection pool для PostgreSQL
# Максимальное количество соединений в pool (рекомендуется 30 для высокой нагрузки)
# Увеличено для поддержки множественных одновременных запросов от queue_processor
DB_POOL_MAX_CONNECTIONS=30
# Минимальное количество соединений в pool (рекомендуется 5 для быстрого старта)
DB_POOL_MIN_CONNECTIONS=5

# Настройки отдельного connection pool для Dashboard API
# Dashboard использует отдельный пул, чтобы не конкурировать с queue_processor
# Максимальное количество соединений в dashboard pool (рекомендуется 30 для высокой нагрузки)
DASHBOARD_DB_POOL_MAX_CONNECTIONS=30
# Минимальное количество соединений в dashboard pool (рекомендуется 10 для быстрого старта)
DASHBOARD_DB_POOL_MIN_CONNECTIONS=10

# ===========================================
# Redis
# ===========================================
# Строка подключения к Redis (опционально, для кэширования)
# Формат: redis://host:port/db
# Пример: redis://localhost:6379/0
# Если Redis недоступен, кэширование отключится автоматически
REDIS_URL=redis://localhost:6379/0

# Ключ Redis очереди для заказов (должен быть одинаковым для всех сервисов)
# Важно: используйте одинаковый ключ в queue_processor, telegram_bot, yandex_mail_parser, yandex_forms_webhook и тестах
REDIS_QUEUE_KEY=orders:queue

# Ключ Redis очереди для сообщений, которые не удалось обработать (Dead Letter Queue)
REDIS_DEAD_LETTER_QUEUE_KEY=orders:dead_letter

# Максимальное количество попыток обработки сообщения из очереди
REDIS_MAX_RETRIES=3

# ===========================================
# Настройки синхронизации каталога
# ===========================================
# Интервал синхронизации каталога из 1С (в секундах)
# Рекомендуемое значение: 3600 секунд (1 час)
ONEC_SYNC_INTERVAL=3600

# Endpoint для получения каталога из 1С
ONEC_CATALOG_ENDPOINT=/hs/api/get/catalog

# TTL кэша в Redis (в секундах)
# Рекомендуемое значение: 300 секунд (5 минут)
CACHE_TTL=300

# ===========================================
# Логирование
# ===========================================
# Формат логирования: true (JSON в файлах) или false (текст)
# JSON формат используется для файлов, консоль всегда в читаемом формате
LOG_JSON_FORMAT=true

# ===========================================
# API Server
# ===========================================
# Порт для FastAPI сервера каталога
API_PORT=8025

# Хост для FastAPI сервера
API_HOST=0.0.0.0

# ===========================================
# Telegram Bot
# ===========================================
# Токен бота от @BotFather
# Получить можно здесь: https://t.me/BotFather
TELEGRAM_BOT_TOKEN=your-telegram-bot-token-here

# ID администратора для уведомлений об ошибках
# Узнать свой ID можно через @userinfobot
TELEGRAM_ADMIN_ID=your-telegram-admin-id-here

# ===========================================
# Яндекс.Почта IMAP
# ===========================================
# IMAP сервер Яндекс.Почты
YANDEX_MAIL_IMAP_HOST=imap.yandex.ru

# Email для мониторинга входящих писем
YANDEX_MAIL_EMAIL=your-email@yandex.ru

# Пароль от почты или app password
# Для Яндекс.Почты рекомендуется использовать app password
# Настройки → Пароли и авторизация → Пароли приложений
YANDEX_MAIL_PASSWORD=your-password-or-app-password

# Папка для мониторинга (по умолчанию INBOX)
YANDEX_MAIL_FOLDER=INBOX

# Интервал опроса писем в секундах (по умолчанию 120 секунд = 2 минуты)
YANDEX_MAIL_POLL_INTERVAL=120

# Whitelist отправителей (опционально, через запятую)
# Если указан, обрабатываются только письма от этих адресов
# Пример: YANDEX_MAIL_WHITELIST=client1@example.com,client2@example.com
# YANDEX_MAIL_WHITELIST=

# Ключевые слова в теме письма (опционально, через запятую)
# Если указаны, обрабатываются только письма с этими словами в теме
# Пример: YANDEX_MAIL_SUBJECT_KEYWORDS=заказ,order,товар
# YANDEX_MAIL_SUBJECT_KEYWORDS=

# ===========================================
# Яндекс.Формы Webhook
# ===========================================
# Секретный ключ для проверки подписи запросов (опционально)
# Если Яндекс.Формы поддерживают подпись запросов, укажите секретный ключ
# YANDEX_FORMS_SECRET=your-secret-key-here

# Порт для webhook сервера (по умолчанию 8026)
WEBHOOK_PORT=8026

# Настройки rate limiting
# Максимальное количество запросов в минуту на IP (по умолчанию 100)
RATE_LIMIT_REQUESTS=100

# Окно времени для rate limiting в секундах (по умолчанию 60)
RATE_LIMIT_WINDOW=60

# ===========================================
# OpenAI / AI Parser
# ===========================================
# API ключ OpenAI
# Получить можно здесь: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here

# Модель для использования (по умолчанию gpt-4.1-mini)
OPENAI_MODEL=gpt-4.1-mini

# BASE URL для OpenAI API (прокси)
# Используется для работы через прокси-сервер
OPENAI_BASE_URL=https://api.proxyapi.ru/openai/v1

# ===========================================
# Queue Processor
# ===========================================
# Количество параллельных воркеров для обработки очереди (по умолчанию 10)
WORKER_CONCURRENCY=10

# Максимальное количество попыток обработки сообщения из очереди
QUEUE_MAX_RETRIES=3

# Порт для health check endpoint (по умолчанию 8027)
HEALTH_CHECK_PORT=8027

# ===========================================
# Доставка
# ===========================================
# Правила расчёта доставки (опционально, JSON формат)
# Если не указано, используются правила по умолчанию
# DELIVERY_RULES_JSON={"москва":{"weight_ranges":[{"max_weight":5.0,"cost":500,"days":1}]}}

# ===========================================
# Генерация счётов (Invoice Generator)
# ===========================================
# Название компании для счёта
COMPANY_NAME=ООО "Ваша Компания"

# ИНН компании
COMPANY_INN=1234567890

# КПП компании
COMPANY_KPP=123456789

# Адрес компании
COMPANY_ADDRESS=г. Иркутск, ул. Примерная, д. 1

# ===========================================
# Dashboard для менеджера
# ===========================================
# Порт для Dashboard API (по умолчанию 8028)
DASHBOARD_PORT=8028

# TTL кэша для Dashboard API в секундах (по умолчанию 60)
DASHBOARD_CACHE_TTL=60

# Порт для Payments API (по умолчанию 8029)
PAYMENTS_PORT=8029

# Публичный базовый URL платёжного сервиса для генерации ссылок оплаты.
# ВАЖНО: если не задан — система автоматически определяет IP машины в локальной сети.
# Для корректной работы ссылок из email и Telegram укажите реальный IP или домен:
#   Пример (локальная сеть): APP_BASE_URL=http://192.168.1.100:8029
#   Пример (продакшн):       APP_BASE_URL=https://pay.mycompany.com
# Узнать IP машины: запустите `ipconfig` (Windows) или `ip addr` (Linux)
APP_BASE_URL=

# ===========================================
# SMTP для отправки email-уведомлений
# ===========================================
# SMTP сервер для отправки email
# Для Яндекс.Почты: smtp.yandex.ru
# Для Gmail: smtp.gmail.com
SMTP_HOST=smtp.yandex.ru

# Порт SMTP сервера
# Для SSL: 465 (по умолчанию)
# Для TLS: 587
SMTP_PORT=465

# Логин для SMTP (обычно email)
SMTP_USER=your-email@yandex.ru

# Пароль для SMTP (или app password)
# Для Яндекс.Почты рекомендуется использовать app password
# Настройки → Пароли и авторизация → Пароли приложений
SMTP_PASSWORD=your-smtp-password

# Email отправителя (если отличается от SMTP_USER)
SMTP_FROM_EMAIL=your-email@yandex.ru

# Имя отправителя
SMTP_FROM_NAME=SmartOrder Engine

# Использовать SSL для SMTP (true/false)
# Для порта 465 обычно true
SMTP_USE_SSL=true

# Использовать TLS для SMTP (true/false)
# Для порта 587 обычно true
SMTP_USE_TLS=false
